# OSI 7 Layer

<br/>

## Application Layer
- 응용 프로세스와 직접 관계하여 일반적인 응용 서비스 수행

- 사용자나 응용 프로그램 사이에 데이터의 교환이 가능하게 하는 계층

- 응용 프로세스 간의 정보 교환, 파일전송, VPN 등의 서비스 제공

- 프로토콜: DNS, HTTP, FTP, 터미널 서비스(VPN), SMTP, POP3, IMAP, ...

### FTP
File Transfer Protocol. 파일 전송을 위해 사용되는 프로토콜. 보통 20번, 21번 포트를 사용한다.  
윈도우에선 FileZilla 프로그램 주로 사용

**Active mode vs Passive mode**
- Active mode  
  1\. 클라이언트(n번 포트)는 서버(21번 포트)로 접속한 후에 자신이 사용할 두 번째 포트(n + 1)를 서버에 알려준다.

  2\. 서버(21번 포트)는 클라이언트(n번 포트)로 요청에 응답한다.
  
  3\. 서버(20번 포트)는 클라이언트가 알려준 두 번째 포트(n + 1)로의 접속을 시도한다.
  
  4\. 클라이언트(n + 1)는 서버(20번 포트)로 요청에 응답한다.

  특징
  - 클라이언트에서 외부 접근을 막아둔다면 ftp 접속이 정상적으로 이뤄지지 않는다.
  
  - 서버 측은 OUTBOUND(내부 -> 외부), 클라이언트 측은 INBOUND(외부 -> 내부) 설정을 해줘야 한다.

- Passive mode  
  1\. 클라이언트(n번 포트)가 서버(21번 포트)로 Passive mode 연결 접속을 시도한다.
  
  2\. 서버(21번 포트)는 사용할 두 번째 포트를 클라이언트(n번 포트)에게 알려준다.
  
  3\. 클라이언트는 다른 포트(n + 1번 포트)를 열어 서버가 알려준 포트로 접속을 시도한다.
  
  4\. 서버(서버가 알려준 포트)가 클라이언트(n + 1)의 요청에 응답한다.

  특징
  - 20번 포트를 사용하지 않고 1024번 ~ 65535번 중 임의의 포트를 사용한다.
  
  - 서버가 임의의 포트를 사용함에 따라 클라이언트도 INBOUND 설정을 모두 해줘야 한다.
  
  - Passive 포트 범위 설정을 해주면 어느정도 문제 해결이 가능하다.

<br/>

## Presentation Layer
- 응용 계층으로부터 받은 데이터를 하위 계층인 세션 계층에 보내기 전에 통신에 적당한 형태로 변환하고 세션 계층에서 받은 데이터는 응용 계층에 맞게 변환하는 역할 수행. 코드 간의 번역 담당

- 코드 변환, 구문 검색, 데이터 압축 및 암호화 등의 기능 담당

- 프로토콜: JPG, MPEG, ...

<br/>

## Session Layer
- 양 끝 단의 응용 프로세스가 통신을 관리하기 위한 방법을 제공

- 통신 세션을 구성하며 포트 번호를 기반으로 연결

- 전송 계층이 종단간에 논리적인 설정을 담당한다면 세션 계층은 이런 연결에 정보 교환을 효과적으로 할 수 있게 추가 서비스 진행

- 프로토콜: NetBIOS, SSH, TLS, ...

<br/>

## Transport Layer
- 시스템에 도착한 후, Packet이 찾아갈 응용 프로그램과 통하는 통로 번호인 port와 연관

- 패킷의 전송이 유효한지 확인하고 전송에 실패된 패킷을 다시 보내는 것과 같은 신뢰성 있는 통신 보장

- 주소 설정, 오류 및 흐름 제어 등을 수행

- 전송단위: Segment

- 프로토콜: TCP, UDP, ...

- 장비: Gateway, L4 Switch

### 4계층 기준 Packet 구조
5계층까지의 패킷 정보 | 출발지 포트 | 목적지 포트 | 출발지 IP | 목적지 IP | 출발지 MAC | 목적지 MAC

### 주요 Port와 Service
포트 번호 | 서비스
:---: | :---:
20 | FTP
21 | FTP
23 | Telnet
25 | SMTP
53 | DNS
80 | HTTP
110 | POP3
143 | IMAP

<br/>

## Network
- 여러 개의 노드를 거칠때마다 경로를 찾아주어 다중 네트워크 링크에서 발신지로부터 목적지까지 전달할 책임 존재

- 시작점에서 목적지까지 성공적으로 전달되도록 하는 역할 수행

- 다양한 길이의 데이터를 네트워크를 통해 전달하며 그 과정에서 라우팅, 흐름 제어, 세그멘테이션, 오류 제어 등 수행

- 전송단위: Packet

- 프로토콜: IP, ICMP, ...

- 장비: Router, L3 Switch

### 3계층 기준 Packet 구조
4계층까지의 패킷 정보 | 출발지 IP | 목적지 IP | 출발지 MAC | 목적지 MAC 

### Routing
네트워크상에서 주소를 이용해 목적지까지 메시지를 전달하는 방법을 체계적으로 결정하는 경로선택 과정  
네트워크 계층 통신을 하는 모든 장치는 라우팅 테이블 소유

**※ traceroute**  
최종 host까지 패킷이 거쳐가는 라우터 길 출력. windows에선 tracert  
ping과 동일하게 ICMP 프로토콜을 이용해 경로 확인  
패킷의 전송 지연을 측정하기 위한 유틸리티

### Static Routing
- 관리자가 네트워크 연결 상태를 파악하여 경로를 선택해 패킷을 전송하는 방식

- 경로 설정이 실시간으로 이뤄지지 않기 때문에 초기에 관리자가 다양한 라우팅 정보를 분석하여 최적의 경로 설정 가능  

- 라우팅 알고리즘을 이용하지 않으므로 라우터의 부하 감소

- 네트워크 환경 변화에 능동적인 대처가 어려워 관리자가 직접 경로를 산출해 제공해야 함

- 비교적 환경 변화가 적은 형태의 네트워크에 적합

### Dynamic Routing
- 라우터가 네트워크 연결 상태를 스스로 파악하여 최적의 경로를 선택해 패킷을 전송하는 방식

- 경로 설정이 실시간으로 이뤄져 네트워크 환경 변화에 능동적인 대처 가능

- 라우팅 알고리즘을 통해 자동으로 경로 설정이 이뤄져 관리가 쉬움

- 주기적인 라우팅 정보 송수신으로 인한 대역폭 낭비 초래

- 네트워크 환경 변화 시, 라우터에 의한 경로 재설정으로 라우터의 처리 부하가 증가하고 지연 발생

- 수시로 환경이 변하는 형태의 네트워크에 적합

구분 | Static Routing | Dynamic Routing
--- | --- | ---
라우팅 테이블 관리 | 수동<br/>네트워크 변화에 대한 자동 인지 불가 | 자동<br/>네트워크 변화에 대해 자동으로 경로 재구성
처리 부하 | 라우팅 테이블 갱신을 위한 별도의 부하 x<br/>CPU와 메모리 부하 적음 | 라우팅 테이블 갱신을 위해 라우터 간 정보 교환 실시<br/>CPU와 메모리 부하 큼
인터페이스 | 변경이 적을 때 유리 | 변경이 많을 때 유리

### 네트워크 관리 도구
- ifconfig

- netstat: network statistics. 여러 네트워크 통계 정보를 보여주는 도구

- nmcli: command line interface로 네트워크를 관리 하는 도구

- nmtui: text user interface. 네트워크 관리를 시각적으로 할 수 있는 도구. network-scripts 파일을 수정하여, 네트워크를 설정. GUI 환경을 이용할 수 없을 때 사용. nmcli는 옵션이 많으므로 어려우니 nmtui를 보통 사용.

- 수동 설정: vi /etc/sysconfig/network-scripts/ifcfg-xxx

<br/>

## Data Link
- 두 개의 개방 시스템들 간의 효율적이고 신뢰성 있는 정보 전송을 할 수 있도록 하며 오류 검출과 회복을 위한 오류 제어 기능 수행

- 송신측과 수신측의 속도 차이를 해결하기 위해 흐름 제어 가능

- 프레임의 시작과 끝을 구분하기 위한 프레임의 동기화 기능 수행

- 전송단위: Frame

- 프로토콜: MAC, PPP, ARP, ...

- 장비: Bridge, Switch

### 2계층 기준 Packet 구조
3계층까지의 패킷 정보 | 출발지 MAC | 목적지 MAC

<br/>

## Physical
- 물리적, 전기적, 기계적 매체를 통해 데이터 bit를 전송하기 위해 요구되는 기능들을 정의

- 전송단위: Bit

- 프로토콜: Ethernet, RS-232C, ...

- 장비: Hub, Repeater
