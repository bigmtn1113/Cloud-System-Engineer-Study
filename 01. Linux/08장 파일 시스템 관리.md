# 파일 시스템 관리

<br/>

## Linux 파일 시스템의 종류
### 파일 시스템이란?
파일과 디렉터리의 집합을 구조적으로 관리하는 체계

### Linux 고유의 디스크 기반 파일 시스템
ext4 - 1EB(엑사 바이트. 1024 * 1024TB) 이상의 볼륨과 16TB 이상의 파일을 지원한다.

### Linux에서 지원하는 다른 디스크 기반 파일 시스템
- nfs - Network File System. 원격 서버의 디스크를 연결할 때 사용
- ntfs - 윈도우의 NTFS를 지원하기 위한 파일 시스템

### Linux의 특수 용도 가상 파일 시스템
- swap - 스왑 영역을 관리하기 위한 파일 시스템  
- tmpfs - Temporary File System. 메모리에 임시 파일을 저장하기 위한 파일 시스템. 시스템 재시작할 때마다 기존 내용이 없어진다.

<br/>

## Linux 파일 시스템의 구조
효율적으로 디스크를 사용하기 위해 저장 장치를 논리적인 블록 그룹으로 구분한다.  
일반적으로 블록은 4KB이고 실제 크기는 시스템의 설정에 따라 변경이 가능하다.

### Linux의 모든 파일 시스템의 기본 개념
파일은 inode로 관리된다.  
디렉터리는 단순한 파일의 목록을 갖고 있는 파일이다.  
특수 파일을 통해 장치에 접근할 수 있다.

### 한 파일 시스템 구성
디렉터리 계층 구조에서 보이는 모든 디렉터리와 파일을 하나의 파일 시스템으로 구성

### 여러 파일 시스템 구성
디렉터리 계층 구조를 여러 파일 시스템으로 구분하여 구성  
여러 파일 시스템으로 나누어 디렉터리 계층 구조를 구성할 경우, 일부 파일 시스템에 문제가 생기더라도 다른 파일 시스템의 파일은 안전

<br/>

## 파일 시스템 마운트
### 마운트
파일 시스템을 디렉터리 계층 구조의 특정 디렉터리와 연결하는 것

### 마운트 포인트
디렉터리 계층 구조에서 파일 시스템이 연결되는 디렉터리

### 파일 시스템 마운트 설정 파일
시스템 부팅 시, 자동으로 파일 시스템이 마운트되게 하려면 /etc/fstab 파일(파일 시스템의 마운트 설정 정보)에 설정

### /etc/fstab 파일의 구조
`장치명  마운트 포인트  파일 시스템 종류  옵션  덤프 관련 설정  파일 점검 옵션`  
ex) `/dev/sdb1 /u01 ext4 defaults,noexec 1 2`

- 옵션: 파일 시스템의 속성 지정  
  ex) defaults: 일반적인 파일 시스템에 지정하는 속성
- 덤프 관련 설정: 0(dump 불가), 1(dump 가능)
- 파일 점검 옵션: 0(부팅 시, fsck 생략), 1(루트 파일시스템), 2(루트 파일시스템 이외)

### 마운트 관련 명령어
mount  
- mount 장치명 마운트 포인트: 파일 시스템 마운트
- mount -t 장치명 마운트 포인트: 파일 시스템 종류 지정

umount  
- umount 장치명 또는 마운트 포인트: 파일 시스템 언마운트

※ umount 에러  
umount를 했는데 target is busy. 라는 메시지가 출력되면 해당 디렉터리를 누군가 사용중이란 뜻이다.  
그럴 경우 umount하고자 하는 디렉터리로 이동해 umount를 실행하면 된다.

<br/>

## 디스크 추가 설치
### 디스크 추가 단계
1. 새 디스크 장착
2. 디스크 파티션 분할
3. 파티션에 파일 시스템 생성(포맷)
4. 디스크 마운트

### fdisk
디스크의 파티션 생성, 삭제, 보기 등 파티션을 관리

- **fdisk 장치명:** 디스크 관리
- **fdisk -l 장치명:** 파티션 테이블 출력

### mkfs
리눅스 파일 시스템 생성

- **mkfs -t 종류 장치명:** 또는 `mkfs.종류 장치명`. 파일 시스템의 종류를 지정(default는 ext2)

### 디스크 추가 설치 과정
1. **새 디스크 장착**

2. **디스크 파티션 분할**  
	1\) **fdisk 장치명:** 디스크 관리 시작. m 입력 시, 이후 작업에 대한 메뉴 표시  
	2\) **n 입력:** 새로운 파티션 생성 진행. 파티션 종류를 선택하는 메뉴 출력  
	3\) **p 입력:** 파티션 종류 선택(p는 기본 파티션). 파티션 번호를 선택하는 메뉴 출력  
	4\) **1 입력:** default가 1이나, 1이 이미 존재할 경우 다음 번호가 default  
	5\) **용량 입력:** 파티션 크기 설정  
	6\) **p 입력:** 파티션 설정 정보 확인  
	7\) **w 입력:** 파티션 설정 정보를 디스크에 기록 후, fdisk 종료  

	추가로 파티션을 나누려면 6번 과정 후, n을 입력해 두 번째 파티션을 추가

3. **파티션에 파일 시스템 생성(포맷)**  
  **mkfs.ext4 장치명:** 또는 mkfs -t ext4 장치명. ext4 파일 시스템 생성

4. **디스크 마운트**  
	1\) **mkdir 디렉터리:** 마운트 포인트 준비  
	2\) **mount 장치명 디렉터리:** 장치를 디렉터리(마운트 포인트)에 마운트

<br/>

## 디스크 관리
### df
디스크의 남은 공간에 대한 정보 출력

- df -h: 디스크 사용량을 알기 쉬운(human. 사람이 보기 좋게) 단위(GB, MB, KB, ..)로 출력

### du
디스크의 사용 공간에 대한 정보 출력

- du -s [디렉터리]: 특정 디렉터리의 전체 사용량 출력
- du -h [디렉터리]: 디스크 사용량을 알기 쉬운(human. 사람이 보기 좋게) 단위(GB, MB, KB, ..)로 출력

### fsck
리눅스의 파일 시스템 검사

- fsck 장치명: 일반적인 파일 시스템 검사
- fsck -f 장치명: 파일 시스템 강제 검사

### badblocks
장치의 배드 블록 검사

- badblocks -v 장치명: 검색 결과를 자세히 출력
- badblocks -o 출력 파일 장치명: 검색 결과를 지정한 출력 파일에 저장
